<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Danh sách các chức năng</h3>
    </div>
    <div class="panel-body">
        <div class="alert alert-danger" role="alert" ng-show="missingTerms.length > 0">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Chú ý:</span>
            Các mã chức năng sau chưa được thêm vào hệ thống
            <ul style="margin-top: 10px;">
                <li ng-repeat="missingTerm in missingTerms" style="color: #3c763d;">{{missingTerm.RoleKeyLabel}} <a href="javascript:;" ng-click="openDialogCreateItem({{missingTerm.RoleKey}})">Thêm</a></li>
            </ul>
        </div>
        <nav class="pagination-container">
            <pagination boundary-links="true" ng-change="pageChanged()" total-items="totalItems" items-per-page="itemsPerPage" ng-model="currentPage" class="pagination" max-size="maxSize" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
        </nav>
        <nav class="navbar navbar-default">
            <div class="container-fluid container-fluid-filter">
                <div class="collapse navbar-collapse">
                    <form class="navbar-form navbar-left">
                        <button type="button" class="btn btn-default" ng-click="removeCheckedItems()" ng-disabled="isDisabledBtnDeleteAll">Xóa các chức năng đã chọn</button>
                        <button type="button" class="btn btn-default" ng-click="openDialogCreateItem()">Thêm mới chức năng</button>
                    </form>
                    <form class="navbar-form navbar-right" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Tìm kiếm..." ng-model="qsearch">
                        </div>
                        <button type="submit" class="btn btn-default" ng-click="searchItems()">GO</button>
                    </form>
                </div>
            </div>
        </nav>
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th class="text-center"><input type="checkbox" ng-model="selectedAll" ng-click="checkAll()" /></th>
                    <th class="text-center">Mã chức năng</th>
                    <th>Tên mã chức năng</th>
                    <th>Tên chức năng</th>
                    <th>Diễn giải</th>
                    <th class="text-center" style="width: 300px;">Tùy chọn</th>
                </tr>
            </thead>
            <tbody>
                <tr data-ng-repeat="item in items">
                    <td class="text-center"><input type="checkbox" ng-model="item.Selected" /></td>
                    <td class="text-center">{{item.RoleKey}}</td>
                    <td>{{item.RoleKeyLabel}}</td>
                    <td>{{item.Name}}</td>
                    <td>{{item.Description}}</td>
                    <td class="text-center">
                        <button type="button" class="btn btn-default" ng-click="openDialogViewGrantedUsers(item.Id)">Thành viên có quyền </button>
                        <button type="button" class="btn btn-default" ng-click="openDialogEditItem(item.Id)">Sửa</button>
                        <button type="button" class="btn btn-default" ng-click="removeItem(item.Id)" ng-disabled="isDisabledBtnDelete{{item.Id}}">Xóa</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <nav class="navbar navbar-default">
            <div class="container-fluid container-fluid-filter">
                <div class="collapse navbar-collapse">
                    <form class="navbar-form navbar-left">
                        <button type="button" class="btn btn-default" ng-click="removeCheckedItems()" ng-disabled="isDisabledBtnDeleteAll">Xóa các chức năng đã chọn</button>
                        <button type="button" class="btn btn-default" ng-click="openDialogCreateItem()">Thêm mới chức năng</button>
                    </form>
                    <form class="navbar-form navbar-right" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Tìm kiếm..." ng-model="qsearch">
                        </div>
                        <button type="submit" class="btn btn-default" ng-click="searchItems()">GO</button>
                    </form>
                </div>
            </div>
        </nav>
        <nav class="pagination-container">
            <pagination boundary-links="true" ng-change="pageChanged()" total-items="totalItems" items-per-page="itemsPerPage" ng-model="currentPage" class="pagination" max-size="maxSize" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
        </nav>
    </div>
</div>

<!-- Begin modal create -->
<script type="text/ng-template" id="modalCreateTermContent.html">
    <form name="addForm" id="addForm" novalidate valid-submit="createItem()">
        <div class="modal-header">
            <h3 class="modal-title">Thêm mới chức năng</h3>
        </div>
        <div class="modal-body">
            <div class="form-group" show-errors>
                <label class="control-label" for="roleKey">Mã chức năng:</label>
                <select class="form-control" id="roleKey" name="roleKey" ng-model="item.RoleKey" ng-options="value.RoleKey as value.RoleKeyLabel group by value.Group for value in listRoleOptions" required >
                    <option value="">-- Chọn mã chức năng --</option>
                </select>
                <p class="help-block" ng-show="addForm.roleKey.$error.required">Mã chức năng không được bỏ trống</p>
            </div>
            <div class="form-group" show-errors>
                <label class="control-label" for="name">Tên chức năng:</label>
                <input type="text" class="form-control" id="name" name="name" ng-model="item.Name" required />
                <p class="help-block" ng-show="addForm.name.$error.required">Tên chức năng không được bỏ trống</p>
            </div>
            <div class="form-group" show-errors>
                <label class="control-label" for="dienGiai">Diễn giải:</label>
                <input type="text" class="form-control" id="description" name="description" ng-model="item.Description" />
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" type="submit" ng-disabled="isDisabledBtnCreate">Thêm mới</button>
            <button class="btn btn-default" type="button" ng-click="cancel()">Đóng</button>
        </div>
    </form>
</script>
<!-- End modal create -->
<!-- Begin modal edit -->
<script type="text/ng-template" id="modalEditTermContent.html">
    <form name="editForm" id="editForm" novalidate valid-submit="updateItem()">
        <div class="modal-header">
            <h3 class="modal-title">Hiệu chỉnh thông tin chức năng</h3>
        </div>
        <div class="modal-body">
            <div class="form-group" show-errors>
                <label class="control-label" for="roleKey">Mã chức năng:</label>
                <select class="form-control" id="roleKey" name="roleKey" ng-model="item.RoleKey" ng-options="value.RoleKey as value.RoleKeyLabel group by value.Group for value in listRoleOptions" required >
                    <option value="">-- Chọn mã chức năng --</option>
                </select>
                <p class="help-block" ng-show="editForm.roleKey.$error.required">Mã chức năng không được bỏ trống</p>
            </div>
            <div class="form-group" show-errors>
                <label class="control-label" for="name">Tên chức năng:</label>
                <input type="text" class="form-control" id="name" name="name" ng-model="item.Name" required />
                <p class="help-block" ng-show="editForm.name.$error.required">Tên chức năng không được bỏ trống</p>
            </div>
            <div class="form-group" show-errors>
                <label class="control-label" for="description">Diễn giải:</label>
                <input type="text" class="form-control" id="description" name="description" ng-model="item.Description" />
                <p class="help-block" ng-show="editForm.description.$error.required">Diễn giải không được bỏ trống</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" type="submit" ng-disabled="isDisabledBtnUpdate">Cập nhật</button>
            <button class="btn btn-default" type="button" ng-click="cancel()">Đóng</button>
        </div>
    </form>
</script>
<!-- End modal create -->
<!-- Begin modal view granted user -->
<script type="text/ng-template" id="modalViewGrantedUsersContent.html">
    <form name="editForm" id="editForm" novalidate valid-submit="updateItem()">
        <div class="modal-header">
            <h3 class="modal-title">{{item.RoleKeyLabel}}</h3>
            Các thành viên được cấp quyền
        </div>
        <div class="modal-body" ng-hide="grantedUsers.length==0">
            <table class="table table-striped table-bordered table-hover" style="margin-bottom: 0;">
                <tbody>
                    <tr data-ng-repeat="item in grantedUsers">
                        <td>{{item.UserName }}</td>
                        <td>{{item.Email }}</td>
                        <td>{{item.PhoneNumber}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-body" ng-hide="grantedUsers.length>0">
            Không có thành viên nào được cấp quyền với chức năng này
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" type="button" ng-click="cancel()">Đóng</button>
        </div>
    </form>
</script>
<!-- End modal view granted user -->